---
title: Authentication
description: Completing your CodeType sign-in and redirecting you back to the app.
layout: base.njk
breadcrumb:
  - label: codetype
    href: /
  - label: callback.json
    href: /auth/callback/
---

<div class="auth-container">
  <div class="auth-card">
    <div id="callback-loading" class="auth-loading">
      <div class="spinner"></div>
      <p>Completing sign in...</p>
    </div>

    <div id="callback-success" class="auth-success" style="display: none;">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      </div>
      <h2>Success!</h2>
      <p id="success-message">Redirecting...</p>
    </div>

    <div id="callback-error" class="auth-error" style="display: none;">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
      </div>
      <h2>Something went wrong</h2>
      <p id="error-message">Authentication failed</p>
      <a href="/auth/login/" class="btn btn-primary">Try Again</a>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
  import { getAuth, getRedirectResult, setPersistence, inMemoryPersistence } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

  const firebaseConfig = window.FIREBASE_CONFIG;

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  setPersistence(auth, inMemoryPersistence);

  const loadingEl = document.getElementById('callback-loading');
  const successEl = document.getElementById('callback-success');
  const errorEl = document.getElementById('callback-error');
  const successMessage = document.getElementById('success-message');
  const errorMessage = document.getElementById('error-message');

  // Handle redirect result from OAuth
  async function handleCallback() {
    try {
      const result = await getRedirectResult(auth);

      if (result && result.user) {
        loadingEl.style.display = 'none';
        successEl.style.display = 'block';

        const urlParams = new URLSearchParams(window.location.search);
        const source = urlParams.get('source');

        if (source === 'extension') {
          const token = await result.user.getIdToken();
          successMessage.textContent = 'Redirecting back to VS Code...';
          window.location.href = `vscode://thisisnsh.codetype/auth-callback?token=${encodeURIComponent(token)}`;
        } else {
          successMessage.textContent = 'Redirecting to dashboard...';
          setTimeout(() => {
            window.location.href = '/dashboard/';
          }, 1000);
        }
      } else {
        // No redirect result, check if already signed in
        const user = auth.currentUser;
        if (user) {
          window.location.href = '/dashboard/';
        } else {
          window.location.href = '/auth/login/';
        }
      }
    } catch (error) {
      loadingEl.style.display = 'none';
      errorEl.style.display = 'block';
      errorMessage.textContent = error.message || 'Authentication failed';
    }
  }

  handleCallback();
</script>
